import{Q as D}from"./QImg.2662e198.js";import{_ as T,s as i,aa as z,b as E,o as n,c as N,f as t,k as o,e as s,F as W,a2 as y,aY as $,i as u,W as w,z as L,Q as F,X as P,a0 as M,a as O,a4 as R,a5 as X,a3 as Y}from"./index.ba439cff.js";import{a as G,Q as d}from"./QCard.44961b50.js";import{Q as p}from"./QInput.2cca6949.js";import{Q as H}from"./use-fullscreen.55e5fbb6.js";import{Q as J}from"./QCardActions.c78fe0d7.js";import{Q as K}from"./QForm.b736d710.js";import{Q as Z}from"./QDialog.29552595.js";import{Q as ee,a as ae,b as c}from"./QResponsive.98008f3d.js";import{C as le}from"./ClosePopup.050b1626.js";import{u as te}from"./use-quasar.ee20863a.js";import{v as oe}from"./index.e99663fb.js";/* empty css                */import"./use-ratio.9a50bd66.js";import"./use-dark.69d94835.js";import"./focus-manager.a1b6aa0a.js";import"./use-prevent-scroll.0d45c8fb.js";import"./use-model-toggle.ad038e0e.js";import"./focusout.d66d2afd.js";import"./QList.6584b0e2.js";import"./QMarkupTable.1a369fc8.js";import"./QSelect.c1323b0e.js";import"./QChip.74fd4d1b.js";import"./QItem.c605af37.js";import"./QMenu.2d6b86f7.js";import"./rtl.b51694b1.js";import"./format.865294d5.js";const m=f=>(R("data-v-13c3276a"),f=f(),X(),f),re={id:"form"},se=m(()=>s("div",{class:"text-h7 q-mt-md q-mr-lg"},"\xA0\xA0ID\xA0",-1)),ie=m(()=>s("div",{class:"text-h7 q-mt-md q-mr-lg"},"\u6B0A\u9650",-1)),ne=m(()=>s("div",{class:"text-h7 q-mt-md q-mr-lg"},"\u66B1\u7A31",-1)),de=m(()=>s("div",{class:"text-h7 q-mt-md q-mr-lg"},"\u4FE1\u7BB1",-1)),me=m(()=>s("div",{class:"text-h7 q-mt-md q-mr-lg"},"\u505C\u6B0A",-1)),ue=m(()=>s("div",{id:"title",class:"q-ml-xl q-my-lg q-pl-lg q-py-sm text-h4 text-weight-bold non-selectable"},"\u6703\u54E1\u8CC7\u6599\u7BA1\u7406",-1)),pe={id:"container",class:"flex justify-center q-px-xl q-pb-xl"},ce=["src"],fe={__name:"MemberManagement",setup(f){const x=te(),k=i(""),U=[{name:"avatar",required:!0,label:"\u982D\u8CBC",align:"center",field:"avatar",sortable:!1},{name:"nickname",required:!0,label:"\u7A31\u547C",align:"center",field:"nickname",sortable:!1},{name:"_id",required:!0,label:"\u6703\u54E1 id",align:"center",field:"_id",sortable:!0},{name:"email",required:!0,label:"email",align:"center",field:"email",sortable:!0},{name:"role",required:!0,label:"\u6B0A\u9650",align:"center",field:"role",sortable:!1},{name:"block",required:!0,label:"\u505C\u6B0A",align:"center",field:"block",sortable:!0},{name:"edit",required:!0,label:"\u7DE8\u8F2F",align:"center",field:"edit",sortable:!1}],V=z([]),Q=async()=>{try{const{data:l}=await y.get("/users/all");V.splice(0,V.length,...l.result)}catch(l){x.notify({type:"negative",message:l.response.data.message})}};Q();const h=i(!1),B=()=>{h.value=!h.value},q={required:l=>!!l||"\u6B04\u4F4D\u5FC5\u586B",email:l=>oe.isEmail(l)||"\u4FE1\u7BB1\u683C\u5F0F\u932F\u8AA4"},v=i(!1),I=i([]),a=z({avatar:[],oldImg:"",nickname:"",userId:"",email:"",role:"",block:0}),j=l=>{v.value=!0,a.avatar=l.avatar,a.oldImg=l.avatar,a.nickname=l.nickname,a.userId=l._id,a.email=l.email,l.role===0?a.role="\u6703\u54E1":a.role="\u7BA1\u7406\u54E1",l.block===0?a.block=!1:a.block=!0},A=async l=>{const r=await y.get("/products/user/"+l),_=new FormData;await _.append("sell",!1);for(const e of r.data.result)await y.patch("/products/block/"+e._id,_)},S=async()=>{try{const l=new FormData;l.append("nickname",a.nickname),l.append("email",a.email),a.avatar.length===0||typeof a.avatar=="string"?l.append("avatar",a.oldImg):l.append("avatar",a.avatar[0].file),a.block===!0?(l.append("block",1),A(a.userId)):l.append("block",0),await y.patch("/users/all/"+a.userId,l),await Y.fire({icon:"success",title:"\u66F4\u65B0\u6210\u529F",showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp"},iconColor:"#F198AF",confirmButtonColor:"#F198AF",width:"20rem"}),Q()}catch(l){x.notify({type:"negative",message:l.response.data.message})}},g=i(""),b=i(""),C=()=>{window.innerWidth>975?(g.value=12,b.value=5):window.innerWidth>1200?(g.value=5,b.value=5):(g.value=2,b.value=2)};return C(),window.addEventListener("resize",()=>{C()}),(l,r)=>{const _=E("VueFileAgent");return n(),N(W,null,[t(Z,{modelValue:v.value,"onUpdate:modelValue":r[8]||(r[8]=e=>v.value=e),persistent:""},{default:o(()=>[s("div",re,[t(K,{onSubmit:$(S,["prevent"])},{default:o(()=>[t(G,{class:"flex column justify-center items-center q-pa-lg q-ma-xl"},{default:o(()=>[t(d,{horizontal:""},{default:o(()=>[h.value?(n(),u(_,{key:0,maxSize:"1MB",deletable:!0,accept:"image/jpg,image/jpeg,image/png",helpText:"\u53EA\u63A5\u53D7 jpg, jpeg \u6216 png \u6A94",modelValue:a.avatar,"onUpdate:modelValue":r[0]||(r[0]=e=>a.avatar=e),rawModelValue:I.value,"onUpdate:rawModelValue":r[1]||(r[1]=e=>I.value=e),errorText:{type:"\u6A94\u6848\u985E\u578B\u4E0D\u5408\u6CD5\u3002\u53EA\u63A5\u53D7 jpg, jpeg \u6216 png \u6A94\u3002",size:"\u6A94\u6848\u5927\u5C0F\u4E0D\u5F97\u5927\u65BC1MB"}},null,8,["modelValue","rawModelValue"])):(n(),u(w,{key:1,onClick:B},{default:o(()=>[t(D,{src:a.oldImg,style:{width:"160px",height:"160px","border-radius":"0"}},null,8,["src"])]),_:1}))]),_:1}),t(d,{horizontal:""},{default:o(()=>[se,t(p,{color:"primary",type:"text",modelValue:a.userId,"onUpdate:modelValue":r[2]||(r[2]=e=>a.userId=e),readonly:""},null,8,["modelValue"])]),_:1}),t(d,{horizontal:""},{default:o(()=>[ie,t(p,{color:"primary",type:"text",modelValue:a.role,"onUpdate:modelValue":r[3]||(r[3]=e=>a.role=e),readonly:""},null,8,["modelValue"])]),_:1}),t(d,{horizontal:""},{default:o(()=>[ne,t(p,{label:"\u8ACB\u8F38\u5165\u66B1\u7A31",color:"primary",type:"text",modelValue:a.nickname,"onUpdate:modelValue":r[4]||(r[4]=e=>a.nickname=e),rules:[q.required]},null,8,["modelValue","rules"])]),_:1}),t(d,{horizontal:""},{default:o(()=>[de,t(p,{label:"\u8ACB\u8F38\u5165\u4FE1\u7BB1",color:"primary",type:"email",modelValue:a.email,"onUpdate:modelValue":r[5]||(r[5]=e=>a.email=e),rules:[q.required,q.email]},null,8,["modelValue","rules"])]),_:1}),t(d,{horizontal:""},{default:o(()=>[me,t(H,{class:"q-mt-sm",color:"primary",modelValue:a.block,"onUpdate:modelValue":r[6]||(r[6]=e=>a.block=e)},null,8,["modelValue"])]),_:1}),t(J,{class:"q-mt-sm"},{default:o(()=>[L(t(w,{type:"submit",unelevated:"",rounded:"",style:{width:"6rem"},size:"1rem",color:"primary",label:"\u9001\u51FA"},null,512),[[le]]),t(w,{unelevated:"",rounded:"",style:{width:"6rem"},size:"1rem",outline:"",color:"primary",label:"\u53D6\u6D88",onClick:r[7]||(r[7]=e=>v.value=!1)})]),_:1})]),_:1})]),_:1},8,["onSubmit"])])]),_:1},8,["modelValue"]),ue,s("div",pe,[t(ee,{id:"wh",ratio:g.value/b.value},{default:o(()=>[t(ae,{"rows-per-page-options":[10,0],columns:U,"row-key":"name",rows:V,filter:k.value},{"top-right":o(()=>[t(p,{color:"white",filled:"",clearable:"",borderless:"",dense:"",debounce:"300",modelValue:k.value,"onUpdate:modelValue":r[9]||(r[9]=e=>k.value=e),placeholder:"\u8ACB\u8F38\u5165\u95DC\u9375\u5B57"},{append:o(()=>[t(F,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-avatar":o(e=>[t(c,{props:e},{default:o(()=>[t(P,{size:"100px"},{default:o(()=>[s("img",{src:e.value},null,8,ce)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-role":o(e=>[e.row.role===1?(n(),u(c,{key:0,props:e},{default:o(()=>[M(" \u7BA1\u7406\u54E1 ")]),_:2},1032,["props"])):(n(),u(c,{key:1,props:e},{default:o(()=>[M(" \u6703\u54E1 ")]),_:2},1032,["props"]))]),"body-cell-block":o(e=>[t(c,{props:e},{default:o(()=>[e.value?(n(),u(F,{key:0,name:"mdi-triangle-outline"})):O("",!0)]),_:2},1032,["props"])]),"body-cell-edit":o(e=>[t(c,{props:e},{default:o(()=>[t(w,{round:"",color:"primary",onClick:ve=>j(e.row),icon:"mdi-file-document-edit"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","filter"])]),_:1},8,["ratio"])])],64)}}};var Le=T(fe,[["__scopeId","data-v-13c3276a"]]);export{Le as default};
